# PWA / Offline Support

This project uses `vite-plugin-pwa` (Workbox) to provide offline support.

## Goals (what “solid offline” means)

- The app **loads offline** after at least one successful online visit (cached app shell).
- Core local functionality (life totals, game state tracking) works offline.
- Updates are safe: a new deployment **doesn’t break an active session**.

## How it works

- Service worker is generated by `vite-plugin-pwa` during build.
- Workbox precaches the built app assets.
- Runtime caching is configured in `vite.config.ts`.

## How to test offline (Chrome)

1. Run `npm run build && npm run preview`.
2. Open DevTools → **Application** → Service Workers:
   - confirm a service worker is registered and activated.
3. Open DevTools → **Network** → check **Offline**.
4. Refresh the page:
   - the app should still load.

Tip: also test a hard reload and closing/reopening the tab while offline.

## Update behavior

We register the service worker manually in `src/main.tsx` via `virtual:pwa-register`.

Note: `vite-plugin-pwa` is configured with `injectRegister: null`, so we don’t double-register.

For now we log `onOfflineReady` / `onNeedRefresh` to the console.
Future improvement: show a UI toast (“Update available”).

### How to test update behavior

1. Run `npm run build && npm run preview` and open the app in Chrome.
2. Open DevTools → **Console** so you can see `onOfflineReady` / `onNeedRefresh` logs.
3. While the app tab is open, deploy a new version (for local testing: change some UI text, rebuild, and restart `npm run preview`).
4. Return to the open tab:
   - the service worker should detect the new version and log an `onNeedRefresh` message.
5. Refresh the page:
   - the new service worker becomes active and the updated version of the app should load (verify by checking the changed UI or version indicator).
